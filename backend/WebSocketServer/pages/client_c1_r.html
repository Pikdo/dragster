<!DOCTYPE html>
<html>

<head>
    <title>Remote Rally</title>
</head>

<body>
    <div>
        Driver 1 Right tire
    </div>
    <div> </div>

    Turbo
    <div ontouchstart="turboCommand()" onmousedown="turboCommand()" style="background-color: rgb(221, 36, 30); height: 100px; width: 100px;">
    </div>
    <!-- Foreward
    <div ontouchstart="forewardCommand('D')" ontouchend="forewardCommand('U')" onmousedown="forewardCommand('D')" onmouseup="forewardCommand('U')" style="background-color: green; height: 100px; width: 100px;">
    </div>
    backward
    <div ontouchstart="backwardCommand('D')" ontouchend="backwardCommand('U')" onmousedown="backwardCommand('D')" onmouseup="backwardCommand('U')" style="background-color: blue; height: 100px; width: 100px;">
    </div> -->
    Foreward
    <div ontouchstart="forewardTimedCommand()" onmousedown="forewardTimedCommand()" style="background-color: green; height: 100px; width: 100px;">
    </div>
    backward
    <div ontouchstart="backwardTimedCommand()" onmousedown="backwardTimedCommand()" style="background-color: blue; height: 100px; width: 100px;">
    </div>

    <div></div>
    Received message
    <!-- <div style="background-color: rgb(221, 36, 30); height: 100px; width: 100px;"> -->
    <div id="ShowReceivedMessage">
    </div>

    <div></div>
    Aceleration Value
    <!-- <div style="background-color: rgb(221, 36, 30); height: 100px; width: 100px;"> -->
    <div id="ShowAcelerationValue">
    </div>
</body>
<script>
    //const serverName = 'ws://192.168.1.69';
    const serverName = 'wss://remotecarcontrol.herokuapp.com';
    const ws = new WebSocket(serverName + '/driver/1/r');

    const divMessage = document.getElementById('ShowReceivedMessage');
    const divValue = document.getElementById('ShowAcelerationValue');
    let acelerationValue = 0;
    let timeoutControl;

    ws.onopen = function() {
        //console.log('WebSocket Client Connected');
        //ws.send('Hi this is web client.');
        //ws.pingInterval = setInterval(() => ws.ping(), 1000 * 45);
    };

    ws.onclose = function() {
        //console.log('WebSocket Client Connected');
        //ws.send('Hi this is web client.');
        //clearInterval(ws.pingInterval);
    };

    ws.onmessage = function(e) {
        divMessage.innerHTML = e.data;
        if (e.data == "...GO...") {
            generateRamdomValue();
        } else if (e.data == "La carrera ha terminado....") {
            clearTimeout(timeoutControl);
            acelerationValue = 0;
            divValue.innerHTML = "";
        }
    };

    // function forewardCommand(event) {
    //     // console.log("forewardMouseDown");
    //     if (event === 'D' || event === 'U') {
    //         ws.send('{RF' + event + '}');
    //     }
    // }

    // function backwardCommand(event) {
    //     // console.log("forewardMouseDown");
    //     if (event === 'D' || event === 'U') {
    //         ws.send('{RB' + event + '}');
    //     }
    // }

    function forewardTimedCommand() {
        // console.log("forewardMouseDown");
        ws.send('{GTF:' + acelerationValue + '}');
        divMessage.innerHTML = "Foreward aceleration: " + acelerationValue;
    }

    function backwardTimedCommand(event) {
        // console.log("forewardMouseDown");
        ws.send('{GTB:' + acelerationValue + '}');
        divMessage.innerHTML = "Backward aceleration: " + acelerationValue;
    }

    function turboCommand() {
        divMessage.innerHTML = "... Turbo ... ";
        ws.send('{GUD}');
    }

    function generateRamdomValue() {
        acelerationValue = Math.round(Math.random() * 10);
        divValue.innerHTML = acelerationValue;
        timeoutControl = setTimeout(generateRamdomValue, 100);
    }
</script>

</html>