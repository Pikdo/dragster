(()=>{"use strict";const e=()=>{const e=["üòè","üòé","üòç","ü§ñ","üò∫","ü§†","ü§ë","üòÅ","üòä","üëΩ","üò¨","ü§©","ü§ó","üòõ","üòÉ","ü§ì","üôÑ","üò¥"];return e[Math.round(Math.random()*(e.length-1))]};let n={nombre:"",control:""};const t=document.getElementById("header"),o=document.getElementById("content");let a={};const r=async()=>{t.innerHTML='\n    <div class="header-title">        \n        <p class="header-title__dragster">DRAGSTER</p>\n        <p class="header-title__race">RACE</p>\n    </div>\n    ';let r=location.hash.slice(1).toLocaleLowerCase().split("/")[1]||"/";switch(await(d=r,d.length<=3?"/"===d?d:"/:id":`/${d}`)){case"/":case"/registro":o.innerHTML='\n    <div class="form">        \n        <h2 class="form__titulo">REGISTRO</h2>\n        <div class="separador"></div>        \n            <input\n                type="text"\n                name="txt_name_player"\n                id="txt_name_player"\n                placeholder="Digite su nombre"\n                required\n                class="form_input"\n            />\n            <input\n                type="button"\n                id="btn_registrar"\n                name="btn_registrar"\n                class="form_input form_button"\n                value="INGRESAR"\n            />        \n        <div id="titulo" class="mensaje"></div>\n    </div>\n    ',i=document.getElementById("btn_registrar"),s=document.getElementById("txt_name_player"),i&&i.addEventListener("click",(function(){console.log(s.value),async function(e){""!==e?"#/registro"!==location.hash&&""!==location.hash||(n.nombre=e,location.hash="#/controles"):alert("Registre un nombre para poder ingresar")}(s.value)}));break;case"/controles":if(""===n.nombre){location.hash="#/registro";break}a=await(async e=>{try{const n=await fetch("http://remotecarcontrol.herokuapp.com/driver",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:e})}).catch((e=>{console.error("Fetch Error:"+e)})),t=await n.json();return 0===Object.keys(t).length?(alert("üòÖ Ya hay 4 jugadores registrados, espere a la siguiente carrera"),void(location.hash="#/registro")):t}catch(e){console.error("Error al obtener driver: "+e)}})(n.nombre),o.innerHTML='\n        <div id="controles" class="form">\n            <div class="form_titulos">\n                <div class="form__titulos_left">                    \n                    <h2 class="form__titulo" id="car"></h2>\n                </div>\n                <div class="form__titulos_right">\n                    <h2 class="form__titulo estado" id="estado">Por iniciar...</h2>\n                </div>\n            </div>\n\n            <div class="separador"></div>\n            <div class="controles_container">\n                <div id="controles_up_down" class="controles_up_down">\n                    <input type="button" id="btn_up" name="btn_up" class="arrow up" value="‚ñ≤" />\n                    <input type="button" id="btn_down" name="btn_down" class="arrow down" value="‚ñº" />\n                </div>\n                <div id="controles_left_right" class="controles_left_right">\n                    <input type="button" id="btn_left" name="btn_left" class="arrow izquierda" value="‚óÄ" />\n                    <input type="button" id="btn_right" name="btn_right" class="arrow down" value="‚ñ∂" />\n                </div>\n            </div>\n            <div class="jugadores_container">\n                <div class="jugador_up_down">\n                    <p id="j1" class="nombre_jugador_1"></p>\n                </div>\n                <div class="jugador_left_right">\n                    <p id="j2" class="nombre_jugador_2"></p>\n                </div>\n            </div>\n            <div class="separador"></div>\n            <div id="text_equipo" class="mensaje">EQUIPO</div>\n        </div>\n    ',(async n=>{const t=new WebSocket("ws://remotecarcontrol.herokuapp.com"+n.uri);var o,a,r,i,s,d,c=!1;function l(e){"D"!==e&&"U"!==e||t.send("{"+n.motor+"F"+e+"}")}function u(e){"D"!==e&&"U"!==e||t.send("{"+n.motor+"B"+e+"}")}t.onopen=function(){console.log("WebSocket Client conectado: ",n.uri),document.getElementById("j1").innerHTML=n.driverName+" "+e(),document.getElementById("car").innerHTML="üöòüì° CARRO "+n.car,t.pingInterval=setInterval((()=>{console.log("Mantener vivo WebSocket"),t.send("{P}"),c||async function(n){let t="https://remotecarcontrol.herokuapp.com/driverNames/"+n.car;const o=await fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET"}).catch((e=>{console.error("Error fetch equipo: "+e)})),a=await o.json();""!=a.A&&""!=a.D&&(c=!0);var r="",i="";"A"===n.motor?(r=" ‚Üï "+a.A+e(),i=e()+" ‚Üî "+a.D):"D"===n.motor&&(r+=" ‚Üî "+a.D+e(),i+=e()+a.A+" ‚Üï "),document.getElementById("j1").innerHTML=r,document.getElementById("j2").innerHTML=i}(n)}),2e3)},t.onclose=function(e){clearInterval(t.pingInterval),console.log("WebSocket Client close"),document.getElementById("estado").innerHTML="Carrera finalizada",setTimeout((()=>{confetti({particleCount:500,spread:150}),location.hash="#/registro"}),1e4)},t.onmessage=function(e){var t,o,a,r;'{"winner":"1"}'!==e.data&&'{"winner":"2"}'!==e.data?document.getElementById("estado").innerHTML=e.data:(t=e.data,o=JSON.parse(t),a=document.getElementById("text_equipo"),r=null,o.winner==n.car?(a.innerHTML="<p> üòé FELICIDADES ü•á</p>",confetti({particleCount:500,spread:150}),r=setInterval((()=>{confetti({particleCount:500,spread:150})}),1500)):a.innerHTML="<p> üòÖ GRACIAS POR PARTICIPAR ü•à</p>",setTimeout((()=>{clearInterval(r)}),1e4))},o=document.getElementById("controles_up_down"),a=document.getElementById("controles_left_right"),r=document.getElementById("btn_up"),i=document.getElementById("btn_down"),s=document.getElementById("btn_left"),d=document.getElementById("btn_right"),"A"===n.motor?(a.style.display="none",console.log("Carga Eventos Aceleraci√≥n"),r.addEventListener("mouseup",(()=>{console.log("btn_adelante suelto"),l("U")})),r.addEventListener("mousedown",(()=>{console.log("btn_adelante presionado"),l("D")})),r.addEventListener("touchstart",(()=>{console.log("btn_adelante presionado"),l("D")})),r.addEventListener("touchend",(()=>{console.log("btn_adelante suelto"),l("U")})),i.addEventListener("mouseup",(()=>{console.log("btn_reversa suelto"),u("U")})),i.addEventListener("mousedown",(()=>{console.log("btn_reversa presionado"),u("D")})),i.addEventListener("touchstart",(()=>{console.log("btn_reversa presionado"),u("D")})),i.addEventListener("touchend",(()=>{console.log("btn_reversa suelto"),u("U")}))):"D"===n.motor&&(o.style.display="none",console.log("Carga Eventos Direcci√≥n"),s.addEventListener("mouseup",(()=>{console.log("btn_izquierda suelto"),l("U")})),s.addEventListener("mousedown",(()=>{console.log("btn_izquierda presionado"),l("D")})),s.addEventListener("touchstart",(()=>{console.log("btn_izquierda presionado"),l("D")})),s.addEventListener("touchend",(()=>{console.log("btn_izquierda suelto"),l("U")})),d.addEventListener("mouseup",(()=>{console.log("btn_derecha suelto"),u("U")})),d.addEventListener("mousedown",(()=>{console.log("btn_derecha presionado"),u("D")})),d.addEventListener("touchstart",(()=>{console.log("btn_derecha presionado"),u("D")})),d.addEventListener("touchend",(()=>{console.log("btn_derecha suelto"),u("U")})))})(a);break;case"/admin":o.innerHTML='<section class="main-container">\n                    <div id="controles" class="form">\n                        <div class="form_titulos">\n                            <div class="form__titulos_left">\n                                <h2 class="form__titulo">ADMIN üèÅ</h2>\n                            </div>\n                            <div class="form__titulos_right">\n                                <h2 class="form__titulo estado" id="estado">Por iniciar...</h2>\n                            </div>\n                        </div>\n                        <div class="separador"></div>\n                        <div class="jugadores_container">\n                            <div class="jugadores_equipo_1">\n                                <input\n                                type="button"\n                                id="btn_gana_1"\n                                name="btn_gana_1"\n                                class="form_input form_button"\n                                value="CAR 1 üöó"                                \n                                /> \n                                <p id="1A"></p>\n                                <p id="1D"></p>\n                            </div>\n                            <div><p class="versus">VS</p></div>\n                            <div class="jugadores_equipo_2">\n                                <input\n                                type="button"\n                                id="btn_gana_2"\n                                name="btn_gana_2"\n                                class="form_input form_button"\n                                value="üöï CAR 2"                                \n                                /> \n                                <p id="2A"></p>\n                                <p id="2D"></p>\n                            </div>\n                        </div>\n                        <form action="post">\n                            <div class="separador"></div>                            \n                            <input\n                                type="button"\n                                id="btn_iniciar_detener"\n                                name="btn_iniciar_detener"\n                                class="form_input form_button"\n                                value="‚ñ∂ Iniciar"\n                            />\n                            <input\n                                type="button"\n                                id="btn_reiniciar"\n                                name="btn_reiniciar"\n                                class="form_input form_button"\n                                value="‚èè Reiniciar"\n                            />\n                    </div>\n                </section>',(()=>{const e="https://remotecarcontrol.herokuapp.com",n=new WebSocket("ws://remotecarcontrol.herokuapp.com/racecontroller");document.getElementById("estado");var t,o,a=document.getElementById("btn_iniciar_detener"),r=document.getElementById("btn_reiniciar"),i=!1,s=!1;function d(e){n.send("{winner:"+e+"}"),function(e){document.getElementById("estado").innerHTML="Ganador equipo:"+e,confetti({particleCount:500,spread:50})}(e)}function c(){0==i&&(console.log("Iniciar la carrera"),n.send("{startRace}"),i=!0)}function l(){console.log("Terminar la carrera"),n.send("{stopRace}"),i=!1,s=!1,a.value="‚ñ∂ Iniciar",document.getElementById("estado").innerHTML="Por iniciar...",document.getElementById("1A").innerHTML="",document.getElementById("1D").innerHTML="",document.getElementById("2A").innerHTML="",document.getElementById("2D").innerHTML=""}function u(){const e=["üòè","üòé","üòç","ü§ñ","üò∫","ü§†","ü§ë","üòÅ","üòä","üëΩ","ü•∞","ü§©","ü§ó","üòõ"];return e[Math.round(Math.random()*(e.length-1))]}n.onopen=function(){n.pingInterval=setInterval((()=>{n.send("{P}"),i||s||async function(){var n=document.getElementById("estado");n.innerHTML="Esperando jugadores...";const t=await fetch(e+"/driverNames/1",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET"}).catch((e=>{console.error("Error fetch equipo: "+e)})),o=await fetch(e+"/driverNames/2",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET"}).catch((e=>{console.error("Error fetch equipo: "+e)}));let a=await t.json(),r=await o.json();console.log("Equipo 1",a),console.log("Equipo 2",r),a.A&&a.D&&r.A&&r.D&&(s=!0,n.innerHTML="Equipos completos"),document.getElementById("1A").innerHTML=a.A?" ‚Üï "+a.A+u():"Sin 1A",document.getElementById("1D").innerHTML=a.D?" ‚Üî "+a.D+u():"Sin 1D",document.getElementById("2A").innerHTML=r.A?u()+r.A+" ‚Üï ":"Sin 2A",document.getElementById("2D").innerHTML=r.D?u()+r.D+" ‚Üî ":"Sin 2D"}(),console.log("iniciado: ",i),console.log("equiposcompletos: ",s)}),2e3)},n.onclose=function(){clearInterval(n.pingInterval)},n.onmessage=function(e){'{"winner":"1"}'!==e.data&&'{"winner":"2"}'!==e.data&&(document.getElementById("estado").innerHTML=e.data)},t=document.getElementById("btn_gana_1"),o=document.getElementById("btn_gana_2"),t.addEventListener("mousedown",(()=>{d(1)})),t.addEventListener("touchstart",(()=>{d(1)})),o.addEventListener("mousedown",(()=>{d(2)})),o.addEventListener("touchstart",(()=>{d(2)})),a.addEventListener("click",(()=>{c()})),a.addEventListener("touchstart",(()=>{c()})),r.addEventListener("click",(()=>{l()})),r.addEventListener("touchstart",(()=>{l()}))})()}var i,s,d};window.addEventListener("load",r),window.addEventListener("hashchange",r)})();