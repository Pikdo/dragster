(()=>{"use strict";let e={nombre:"Jugador",control:""};const n=document.getElementById("header"),t=document.getElementById("content");async function o(n){if(""!==n){if("#/registro"===location.hash||""===location.hash){e.nombre=n;const t=await(async e=>{try{const n=await fetch("http://remotecarcontrol.herokuapp.com/driver",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:e})}).catch((e=>{console.error("Fetch Error:"+e)}));let t=await n.json();return console.log(t),t.nombre=("A"===t.motor?"↕ ":"↔ ")+e,t.emoji=function(){const e=["😏","😎","😍","🤖","😺","🧐","😲","😁","😊","😆","🥰","🤩","🤗","😛"];return e[Math.round(Math.random()*(e.length-1))]}(),t}catch(e){console.error("Error al obtener driver: "+e)}})(n);console.log("driver devuelto",t),document.getElementById("content").innerHTML=(e=>`\n        <div id="controles" class="form">\n            <div class="form_titulos">\n                <div class="form__titulos_left">\n                    <h2 class="form__titulo">🚘📡 CARRO ${e.car}</h2>\n                </div>\n                <div class="form__titulos_right">\n                    <h2 class="form__titulo estado" id="estado">Por iniciar...</h2>\n                </div>\n            </div>\n\n            <div class="separador"></div>\n            <div class="controles_container">\n                <div id="controles_up_down" class="controles_up_down">\n                    <input type="button" id="btn_up" name="btn_up" class="arrow up" value="▲" />\n                    <input type="button" id="btn_down" name="btn_down" class="arrow down" value="▼" />\n                </div>\n                <div id="controles_left_right" class="controles_left_right">\n                    <input type="button" id="btn_left" name="btn_left" class="arrow izquierda" value="◀" />\n                    <input type="button" id="btn_right" name="btn_right" class="arrow down" value="▶" />\n                </div>\n            </div>\n            <div class="jugadores_container">\n                <div class="jugador_up_down">\n                    <p class="nombre_jugador_1">${e.emoji} ${e.nombre}</p>\n                </div>\n                <div class="jugador_left_right">\n                    <p class="nombre_jugador_2"></p>\n                </div>\n            </div>\n            <hr />\n            <div id="text_equipo" class="mensaje">EQUIPO</div>\n        </div>\n    `)(t),(async e=>{const n=new WebSocket("ws://remotecarcontrol.herokuapp.com"+e.uri);function t(t){"D"!==t&&"U"!==t||n.send("{"+e.motor+"F"+t+"}")}function o(t){"D"!==t&&"U"!==t||n.send("{"+e.motor+"B"+t+"}")}var s,a,r,i,d,l;n.onopen=function(){console.log("WebSocket Client conectado: ",e.uri),n.pingInterval=setInterval((()=>{console.log("Mantener vivo ws"),n.send("{P}")}),2e3)},n.onclose=function(e){clearInterval(n.pingInterval),console.log("WebSocket Client close"),document.getElementById("estado").innerHTML="Carrera finalizada"},n.onmessage=function(n){var t,o,s;'{"winner":"1"}'!==n.data&&'{"winner":"2"}'!==n.data?document.getElementById("estado").innerHTML=n.data:(t=n.data,o=JSON.parse(t),s=document.getElementById("text_equipo"),o.winner==e.car?(s.innerHTML="<p> 😎 FELICIDADES 🥇</p>",confetti({particleCount:500})):s.innerHTML="<p> 😅 GRACIAS POR PARTICIPAR 🥈</p>",setTimeout((()=>{location.hash="#/registro"}),1e4))},s=document.getElementById("controles_up_down"),a=document.getElementById("controles_left_right"),r=document.getElementById("btn_up"),i=document.getElementById("btn_down"),d=document.getElementById("btn_left"),l=document.getElementById("btn_right"),"A"===e.motor?(a.style.display="none",console.log("Carga Eventos Aceleración"),r.addEventListener("mouseup",(()=>{console.log("btn_adelante suelto"),t("U")})),r.addEventListener("mousedown",(()=>{console.log("btn_adelante presionado"),t("D")})),r.addEventListener("touchstart",(()=>{console.log("btn_adelante presionado"),t("D")})),r.addEventListener("touchend",(()=>{console.log("btn_adelante suelto"),t("U")})),i.addEventListener("mouseup",(()=>{console.log("btn_reversa suelto"),o("U")})),i.addEventListener("mousedown",(()=>{console.log("btn_reversa presionado"),o("D")})),i.addEventListener("touchstart",(()=>{console.log("btn_reversa presionado"),o("D")})),i.addEventListener("touchend",(()=>{console.log("btn_reversa suelto"),o("U")}))):"D"===e.motor&&(s.style.display="none",console.log("Carga Eventos Dirección"),d.addEventListener("mouseup",(()=>{console.log("btn_izquierda suelto"),t("U")})),d.addEventListener("mousedown",(()=>{console.log("btn_izquierda presionado"),t("D")})),d.addEventListener("touchstart",(()=>{console.log("btn_izquierda presionado"),t("D")})),d.addEventListener("touchend",(()=>{console.log("btn_izquierda suelto"),t("U")})),l.addEventListener("mouseup",(()=>{console.log("btn_derecha suelto"),o("U")})),l.addEventListener("mousedown",(()=>{console.log("btn_derecha presionado"),o("D")})),l.addEventListener("touchstart",(()=>{console.log("btn_derecha presionado"),o("D")})),l.addEventListener("touchend",(()=>{console.log("btn_derecha suelto"),o("U")}))),async function(){const n=(await fetch("https://remotecarcontrol.herokuapp.com/driverNames/"+e.car,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET"}).catch((e=>{console.error("Error fetch equipo: "+e)}))).json();console.log(n)}()})(t)}}else alert("Registre un nombre para poder ingresar")}const s=async()=>{n.innerHTML='\n    <div class="header-title">        \n        <p class="header-title__dragster">DRAGSTER</p>\n        <p class="header-title__race">RACE</p>\n    </div>\n    ';let e=location.hash.slice(1).toLocaleLowerCase().split("/")[1]||"/";switch(await(r=e,r.length<=3?"/"===r?r:"/:id":`/${r}`)){case"/":case"/registro":t.innerHTML='\n    <div class="form">        \n        <h2 class="form__titulo">REGISTRO</h2>\n        <div class="separador"></div>\n        <input\n            type="text"\n            name="txt_name_player"\n            id="txt_name_player"\n            placeholder="Digite su nombre"\n            required\n            class="form_input"\n        />\n        <input\n            type="button"\n            id="btn_registrar"\n            name="btn_registrar"\n            class="form_input form_button"\n            value="INGRESAR"\n        />\n        <div id="titulo" class="mensaje"></div>\n    </div>\n    ',s=document.getElementById("btn_registrar"),a=document.getElementById("txt_name_player"),s&&(s.addEventListener("click",(function(){console.log(a.value),o(a.value)})),s.addEventListener("keyup",(function(e){13===e.code&&(e.preventDefault(),o(a.value))})));break;case"/controles":break;case"/admin":t.innerHTML='<section class="main-container">\n                    <div id="controles" class="form">\n                        <div class="form_titulos">\n                            <div class="form__titulos_left">\n                                <h2 class="form__titulo">🏁ADMIN</h2>\n                            </div>\n                            <div class="form__titulos_right">\n                                <h2 class="form__titulo estado" id="estado">Por iniciar...</h2>\n                            </div>\n                        </div>\n                        <div class="separador"></div>\n                        <div class="jugadores_container">\n                            <div class="jugadores_equipo_1">\n                                <p>CAR 1 🚗</p>\n                                <p class="equipo_1">↕ Tavo 😏</p>\n                                <p class="equipo_1">↔ Leo 😮</p>\n                            </div>\n                            <div><p class="versus">VS</p></div>\n                            <div class="jugadores_equipo_2">\n                                <p>🚕 CAR 2</p>\n                                <p class="equipo_2">🤠 Jose ↕</p>\n                                <p class="equipo_2">🧐 Diego ↔</p>\n                            </div>\n                        </div>                                \n                        <form action="post">\n                            <div class="separador"></div>\n                            \n                            <input\n                                type="button"\n                                id="btn_registrar"\n                                name="btn_registrar"\n                                class="form_input form_button"\n                                value="Iniciar/Detener"\n                            />  \n                            <input\n                                type="button"\n                                id="btn_registrar"\n                                name="btn_registrar"\n                                class="form_input form_button"\n                                value="Reiniciar"\n                            />                 \n                    </div>\n                </section>',console.log("Cargar controles de administración")}var s,a,r};window.addEventListener("load",s),window.addEventListener("hashchange",s)})();